(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0ae997"],{"0b6e":function(t,a,e){"use strict";e.r(a);var l=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{directives:[{name:"loading",rawName:"v-loading",value:!t.isLoaded,expression:"!isLoaded"}],staticClass:"sc-wp wbs-main",class:{"wb-page-loaded":t.isLoaded}},[e("div",{staticClass:"log-box"},[t.$cnf.is_mobile?e("div",{staticClass:"cell-items"},[t.sp_404_url.length?t._e():e("div",{staticClass:"empty-data align-center"},[t._v(" --暂无数据-- ")]),t._l(t.sp_404_url,(function(a,l){return e("div",{key:"item"+l,staticClass:"cell-item with-expand"},[e("div",{staticClass:"cell-hd"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.multipleSelection,expression:"multipleSelection"}],attrs:{type:"checkbox"},domProps:{value:a,checked:Array.isArray(t.multipleSelection)?t._i(t.multipleSelection,a)>-1:t.multipleSelection},on:{change:function(e){var l=t.multipleSelection,s=e.target,i=!!s.checked;if(Array.isArray(l)){var o=a,n=t._i(l,o);s.checked?n<0&&(t.multipleSelection=l.concat([o])):n>-1&&(t.multipleSelection=l.slice(0,n).concat(l.slice(n+1)))}else t.multipleSelection=i}}})]),e("div",{staticClass:"cell-bd primary"},[e("a",{staticClass:"url",attrs:{href:a.url,target:"_blank"}},[t._v(t._s(a.url))]),e("div",{staticClass:"def-hide"},[e("div",{staticClass:"data-label",attrs:{"data-label":"响应码: "}},[t._v(" "+t._s(a.code)+" ")]),e("div",{staticClass:"data-label",attrs:{"data-label":"检测时间: "}},[t._v(" "+t._s(a.visit_date)+" ")]),e("div",{staticClass:"btns"},[e("el-button",{attrs:{plain:"",size:"mini",type:"success",icon:"el-icon-refresh"},on:{click:function(e){return t.check_404_url(a)}}},[t._v("刷新状态")]),e("el-button",{attrs:{size:"mini",type:"danger",plain:"",icon:"el-icon-remove"},on:{click:function(e){return t.del_404_url(a)}}},[t._v("忽略")])],1)])]),e("div",{staticClass:"cell-ft",on:{click:t.$WB.toggleActive}})])}))],2):e("el-table",{staticClass:"wbs-table",staticStyle:{width:"100%"},attrs:{data:t.sp_404_url},on:{"selection-change":t.handleSelectionChange}},[e("el-table-column",{attrs:{type:"selection",width:"55"}}),e("el-table-column",{attrs:{label:"URL地址","class-name":"w35"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticClass:"url"},[e("a",{attrs:{"data-label":"URL: ",href:a.row.url,target:"_blank"}},[e("span",[t._v(t._s(a.row.url))])])])]}}])}),e("el-table-column",{attrs:{label:"响应码状态","class-name":"w15"},scopedSlots:t._u([{key:"header",fn:function(a){return[e("span",{staticClass:"ib"},[t._v("响应码状态")]),e("el-tooltip",{staticClass:"wbui-tooltip",attrs:{placement:"top"}},[e("div",{attrs:{slot:"content"},slot:"content"},[t._v(" 列表404状态URL为蜘蛛分析插件数据，对伪蜘蛛访问数据应该标记为忽略。 ")]),e("div",{staticClass:"wbui-tooltip"},[e("svg",{staticClass:"wb-icon sico-qa"},[e("use",{attrs:{"xlink:href":"#sico-qa"}})])])])]}},{key:"default",fn:function(a){return[e("div",{staticClass:"data-label",attrs:{"data-label":"响应码: "}},[t._v(" "+t._s(a.row.code)+" ")])]}}])}),e("el-table-column",{attrs:{label:"检测时间","class-name":"w15"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticClass:"data-label",attrs:{"data-label":"检测时间: "}},[t._v(" "+t._s(a.row.visit_date)+" ")])]}}])}),e("el-table-column",{attrs:{label:"操作",align:"right"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{attrs:{plain:"",size:"mini",type:"success",icon:"el-icon-refresh"},on:{click:function(e){return t.check_404_url(a.row)}}},[t._v("刷新状态")]),e("el-button",{attrs:{size:"mini",type:"danger",plain:"",icon:"el-icon-remove"},on:{click:function(e){return t.del_404_url(a.row)}}},[t._v("忽略")])]}}])})],1),e("div",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total > 0"}],staticClass:"btns-bar with-ctrl-area"},[e("div",{staticClass:"wb-ctrl-area"},[e("el-select",{attrs:{size:"small",placeholder:"批量操作"},model:{value:t.batch_op,callback:function(a){t.batch_op=a},expression:"batch_op"}},[e("el-option",{attrs:{label:"刷新状态",value:"check"}}),e("el-option",{attrs:{label:"忽略",value:"del"}})],1),e("el-button",{staticClass:"ml-s",attrs:{type:"info",plain:"",size:"small"},on:{click:t.batch_apply}},[t._v("应用")]),e("el-button",{staticClass:"ctrl-btn",attrs:{icon:"el-icon-refresh",plain:"",type:"primary",size:"small"},on:{click:t.check_all}},[t._v("一键刷新")])],1),e("el-pagination",{attrs:{background:"",small:!!t.$cnf.is_mobile,layout:t.$cnf.is_mobile?"pager, total, prev, next":"total, prev, pager, next, jumper","page-sizes":[10,30,50,100],"page-size":t.num,total:1*t.total,"pager-count":5},on:{"size-change":t.handleSizeChange,"current-change":t.nav_page}})],1),t.isLoaded&&t.total?e("div",{staticClass:"sitmap-url-box mt"},[t._m(0),e("div",{staticClass:"wb-code mt"},t._l(t.url_404,(function(a,l){return e("div",{key:"file"+l},[e("a",{attrs:{href:a,target:"_blank"}},[t._v(t._s(a))])])})),0),e("div",{staticClass:"mt"},[e("el-button",{attrs:{icon:"el-icon-copy-document",plain:"",size:"mini"},on:{click:t.export_csv}},[t._v("导出CSV")]),e("el-button",{attrs:{icon:"el-icon-copy-document",plain:"",size:"mini"},on:{click:t.copy_list}},[t._v("复制")]),e("textarea",{staticStyle:{opacity:"0",position:"absolute","z-index":"0"},attrs:{id:"wb_bdsl_404-url"}})],1)]):t._e(),t.bsl_data.spider_install&&t.bsl_data.spider_active?t._e():e("div",{staticClass:"getpro-mask"},[e("div",{staticClass:"mask-inner"},[t.bsl_data.spider_install?t._e():e("div",{staticClass:"tips"},[e("p",[t._v("* 当前功能依赖Spider Analyser-蜘蛛分析插件。")]),e("div",{staticClass:"wb-hl mt"},[e("svg",{staticClass:"wb-icon wbsico-notice"},[e("use",{attrs:{"xlink:href":"#wbsico-notice"}})]),e("span",{staticClass:"ml"},[t._v("未检测到安装，去")]),e("a",{staticClass:"link",attrs:{href:t.bsl_data.spider_setup_url}},[t._v("安装")])])]),t.bsl_data.spider_active?t._e():e("div",{staticClass:"tips"},[e("p",[t._v("* 当前功能依赖Spider Analyser-蜘蛛分析插件。")]),e("div",{staticClass:"wb-hl mt"},[e("svg",{staticClass:"wb-icon wbsico-notice"},[e("use",{attrs:{"xlink:href":"#wbsico-notice"}})]),e("span",[t._v("检测到未启用，去")]),e("a",{staticClass:"link",attrs:{href:t.bsl_data.spider_setup_url}},[t._v("启用")])])])])])],1),e("wb-prompt",{directives:[{name:"show",rawName:"v-show",value:t.isLoaded,expression:"isLoaded"}],staticClass:"mt"})],1)},s=[function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[e("b",[t._v("清单文件:")])])}];const i="WB_BSL_USER_OPT_"+window.uid;var o={name:"Stats404",data(){const t=this;return{isLoaded:!1,bsl_data:t.$cnf.bsl_data,sp_404_url:[],loadmore:1,loading_data:-1,list:[],num:10,total:0,page:1,batch_op:"",multipleSelection:[],url_404:[]}},created(){console.log("-- 404 -- created ---")},mounted(){console.log("-- 404 -- mounted ---");const t=this,a=t.$WB.getLocalStorage(i)||{};t.num=a["PAGE_SIZE"]||10,t.loadData()},methods:{calc_404_url(){const t=this;let a=1e3;t.url_404=[];let e=t.total;if(e>a){let l=Math.ceil(e/a);for(let a=1;a<=l;a++)t.url_404.push(t.home_url("/404-list-"+a+".txt"))}else t.url_404.push(t.home_url("/404-list.txt"))},export_csv(){const t=this;window.open(t.home_url("/404-list.csv"))},loadData(t=!1){const a=this;let e=a.num||10;a.showLoading();const l="WB_BSL_STATS_404",s=a.$WB.getSessionStorage(l,!0);let i=s.data;if(!t&&!a.$WB.updateLocalStorageChecker(s.ver)&&i&&i.num==a.num&&i.sp_404_url[a.page])return a.sp_404_url=i.sp_404_url[a.page],a.total=i.total,a.closeLoading(),a.isLoaded=!0,void a.calc_404_url();a.$api.getData({_ajax_nonce:window._wb_bsl_ajax_nonce||"",action:a.$cnf.action.act,op:"sp_404_url",num:e,page:a.page}).then(t=>{a.sp_404_url=t.data,a.total=t.total,a.calc_404_url(),a.closeLoading(),a.isLoaded=!0,i=a.$WB.getSessionStorage(l)||{sp_404_url:{}},i.sp_404_url[a.page]=a.sp_404_url,i.total=a.total,i.num=e,a.$WB.setSessionStorage(l,i),a.isLoaded=!0}).catch(()=>{a.closeLoading()})},chk_selectable(t,a){return a%2},handleSizeChange(t){let a=e.$WB.getLocalStorage(i)||{};const e=this;e.page=1,e.num=t,a["PAGE_SIZE"]=t,e.$WB.setLocalStorage(i,a),sessionStorage.clear(),e.loadData()},handleSelectionChange(t){this.multipleSelection=t},p_bd(){const t=h(".check-column :checkbox:checked");if(t.length<1)return!1;const a=[];t.each((t,e)=>{a.push(e.value)}),h.post(ajaxurl,{action:"wb_baidu_push_url",op:"batch_bd",post_id:a.join(",")},t=>{alert("推送成功")})},batch_apply(){const t=this;if(!t.batch_op)return!1;if(t.multipleSelection.length<1)return t.$wbui.toast("未选择项目"),!1;if("del"==t.batch_op){let a=[];if(t.multipleSelection.forEach(t=>{a.push(t.url_md5)}),a.length<1)return;t.$wbui.confirm("确认忽略所选链接？",()=>{let e=t.$wbui.toast("执行中...",{time:180});t.$api.saveData({_ajax_nonce:window._wb_bsl_ajax_nonce||"",action:t.$cnf.action.act,op:"del_404_url",url:a}).then(a=>{t.$wbui.close(e),t.$wbui.toast("已忽略所选链接"),t.sp_404_url=[],t.loadmore=1,sessionStorage.removeItem("WB_BSL_STATS_404"),t.loadData(!0)})})}else if("check"==t.batch_op){let a=[],e=[];if(t.multipleSelection.forEach(t=>{a.push(t.id),e.push(t)}),a.length<1)return;let l=t.$wbui.toast("检测中...",{time:180});t.$api.getData({_ajax_nonce:window._wb_bsl_ajax_nonce||"",action:t.$cnf.action.act,op:"check_404_url",id:a}).then(a=>{t.$wbui.close(l),t.$wbui.toast("已全部检测状态"),a.code||a.result&&(sessionStorage.removeItem("WB_BSL_STATS_404"),a.result.forEach((t,a)=>{t.code||(e[a].code=t.data.code,e[a].visit_date=t.data.visit_date)}))})}return!1},showLoading(){const t=this;t.$wbui.close(t.loading_data),t.loading_data=t.$wbui.loading()},closeLoading(){const t=this;t.$wbui.close(t.loading_data),t.loading_data=-1},check_all(){const t=this;let a=t.$wbui.toast("检测中...",{time:180});t.$api.getData({_ajax_nonce:window._wb_bsl_ajax_nonce||"",action:t.$cnf.action.act,op:"check_404_url",total:t.total,all:1}).then(e=>{t.$wbui.close(a),t.$wbui.toast("检测任务提交成功。请过一段时间后查看。"),t.page=1,t.loadData()})},check_404_url(t){const a=this;a.$api.getData({_ajax_nonce:window._wb_bsl_ajax_nonce||"",action:a.$cnf.action.act,op:"check_404_url",id:t.id}).then(e=>{a.$wbui.toast(e.desc+(e.data.code?"<br>响应码为: "+e.data.code:"")),e.code||(sessionStorage.removeItem("WB_BSL_STATS_404"),t.code=e.data.code,t.visit_date=e.data.visit_date)})},del_404_url(t){const a=this;a.$wbui.confirm("确认忽略该链接？",()=>{a.$api.saveData({_ajax_nonce:window._wb_bsl_ajax_nonce||"",action:a.$cnf.action.act,op:"del_404_url",url:t.url_md5,id:t.id}).then(t=>{a.$wbui.toast("已忽略该链接"),a.sp_404_url=[],a.loadmore=1,sessionStorage.removeItem("WB_BSL_STATS_404"),a.loadData(!0)})})},home_url(t){return this.$cnf.home_url+t},copy_list(){const t=this,a=this.$el.querySelector("#wb_bdsl_404-url");a.innerHTML=t.url_404.join("\n"),a.focus(),a.select(),document.execCommand("Copy"),t.$wbui.toast("已复制")},nav_page(t){const a=this;a.page=t,a.loadData()}}},n=o,c=e("2877"),r=Object(c["a"])(n,l,s,!1,null,null,null);a["default"]=r.exports}}]);